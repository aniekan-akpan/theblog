---
import MainLayout from "../../layouts/MainLayout.astro";
import siteConfig from "../../site.config";
import { getAllPodcasts, type Podcast } from "../../utils/strapi";
import PodcastCard from "../../components/PodcastCard.astro";
import { sortItemsByDateDesc } from "../../utils/helpers";

const allPodcasts = (await getAllPodcasts()).sort(sortItemsByDateDesc);

// Pagination
const currentPage = 1;
const postsPerPage = siteConfig.postsPerPage || 9;
const totalPages = Math.ceil(allPodcasts.length / postsPerPage);
const paginatedPodcasts = allPodcasts.slice(0, postsPerPage);
---

<MainLayout
  activePage="podcasts"
  pageTitle={siteConfig.title + " | Podcasts"}
>
  <div class="page-content">
    <div class="podcasts-header">
      <h1 class="sigmar-ff text-balance">Podcasts</h1>
      <p class="podcasts-intro kanit-light text-balance">
        Dive into conversations about technology, life, and random thoughts. Join me as I explore ideas, share experiences, and think out loud.
      </p>
    </div>

    {allPodcasts.length === 0 ? (
      <div class="no-podcasts">
        <svg viewBox="0 0 24 24" fill="currentColor" class="no-podcasts-icon">
          <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
          <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
        </svg>
        <p class="kanit-light">No podcasts available yet. Stay tuned!</p>
      </div>
    ) : (
      <div class="podcasts-grid">
        {paginatedPodcasts.map((podcast) => (
          <PodcastCard podcast={podcast} />
        ))}
      </div>
    )}

    {totalPages > 1 && (
      <div class="pagination-info kanit-light">
        Showing {paginatedPodcasts.length} of {allPodcasts.length} episodes
      </div>
    )}
  </div>
</MainLayout>

<style>
  .podcasts-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .podcasts-intro {
    max-width: 42rem;
    margin: 0 auto;
    font-size: 1.125rem;
    opacity: 0.8;
  }

  .no-podcasts {
    text-align: center;
    padding: 4rem 2rem;
    opacity: 0.6;
  }

  .no-podcasts-icon {
    width: 4rem;
    height: 4rem;
    margin: 0 auto 1rem;
    opacity: 0.5;
  }

  .podcasts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
  }

  @media (max-width: 640px) {
    .podcasts-grid {
      grid-template-columns: 1fr;
    }
  }

  .pagination-info {
    text-align: center;
    padding: 2rem 0;
    opacity: 0.6;
  }
</style>
